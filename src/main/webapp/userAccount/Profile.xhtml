<?xml version="1.0" encoding="UTF-8"?>
<!--
  - Created by Ayush Manish Shah on 2021.11.18
  - Copyright Â© 2021 Ayush Manish Shah. All rights reserved.
  -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">

    <!-- This page is constructed based on the siteTemplate -->
    <ui:composition template="/template/siteTemplate.xhtml">

        <ui:define name="title">
            <!-- Set the page title -->
            <h:outputText value="My Account" />
        </ui:define>

        <!-- Create the content for this page below -->
        <ui:define name="editableContent">

            <h:form id="UserProfileForm">
                <!--
                The table below has 1 row and 2 columns.
                Left column contains the vertical navigation menu.
                Right column contains the user's profile data.
                -->
                <div style="padding-left: 20px">
                <table width="100%" border="0" cellspacing="0" cellpadding="10">
                    <tr>

                        <!--
                        ***********************************************
                        Row 1 Column 1 (Left): VERTICAL NAVIGATION MENU
                        ***********************************************
                        -->
                        <td width="50" align="left" valign="middle" nowrap="nowrap">
                            <h:form id="speedDialForm">
                                <p:tooltip />
                                <p:growl id="messages" showDetail="true"/>

                                <div class="card">
                                    <div class="speeddial-circle-demo" style="position: relative; height: 500px;">
                                        <p:speedDial radius="170" direction="right" type="semi-circle" buttonStyleClass="ui-button-success">
                                            <p:menuitem icon="pi pi-sign-out" title="Sign Out" action="#{userController.logout()}"/>
                                            <p:menuitem icon="pi pi-trash" oncomplete="PF('SecurityQuestionDialog').show()" update=":SecurityQuestionForm" title="Delete Account">
                                                <p:confirm header="Account Deletion Confirmation"
                                                           message="Are you sure to permanently delete your account? This cannot be undone!" />
                                            </p:menuitem>
                                            <!--
                                                    The confirmation dialog is displayed to check if the user really wants to delete the account.
                                                    -->
                                            <p:confirmDialog id="confirmDialogBox1" global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
                                                <div align="center">
                                                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="fas fa-window-close" />
                                                    &nbsp;
                                                    <p:commandButton value="Yes" type="button" class="ui-confirmdialog-yes ui-button-danger" icon="fas fa-check-square" />
                                                </div>
                                            </p:confirmDialog>
                                            <!-- ****************** Delete Account End **************************** -->
                                            <p:menuitem icon="pi pi-key" outcome="/userPasswordChange/EnterUsername" title="Change Password"/>
                                            <p:menuitem icon="pi pi-pencil" outcome="/userAccount/EditAccount" title="Edit Account"/>
                                            <p:menuitem icon="pi pi-camera" outcome="/userPhoto/ChangePhoto" title="Update Profile Photo"/>
                                            <p:menuitem icon="pi pi-chart-line" outcome="/reports/weeklyReports" title="Weekly Report"/>
                                            <p:menuitem icon="pi pi-chart-line" outcome="/reports/dailyReports" title="Daily Report"/>
                                            <p:menuitem icon="pi pi-thumbs-up" outcome="/Achievements/AchievementPage" title="My Achievements"/>
                                            <p:menuitem icon="pi pi-list" outcome="/userWorkout/List" title="My Workouts"/>
                                            <p:menuitem icon="pi pi-list" outcome="/userRecipe/List" title="My Recipes"/>
                                            <p:menuitem icon="pi pi-home" outcome="/index" title="Home"/>
                                        </p:speedDial>
                                    </div>
                                </div>
                            </h:form>
                        </td>
                        <!--
                        *****************************************
                        Row 1 Column 2 (Right): USER PROFILE DATA
                        *****************************************
                        -->
                        <td align="center" valign="top">

                            <h1> #{userController.selected.firstName}&nbsp;#{userController.selected.lastName}'s Account Profile </h1>

                            <!--
                            USER'S PROFILE PHOTO: Display the user's account profile photo in a circle.
                            The cache="false" option enables immediate display of a newly uploaded photo without using cache.
                            -->
                            <p:graphicImage cache="false" styleClass="profilePhoto" value="#{userController.userPhoto()}" />
                            <br />
                            <br />
                            <p:panelGrid columns="2" columnClasses="panelGridColumn1, panelGridColumn2" >

                                <h:outputText value="First Name:"/>
                                <h:outputText value="#{userController.selected.firstName}" />

                                <h:outputText value="Middle Name:"/>
                                <h:outputText value="#{userController.selected.middleName}" />

                                <h:outputText value="Last Name:"/>
                                <h:outputText value="#{userController.selected.lastName}" />

                                <h:outputText value="Address Line 1:"/>
                                <h:outputText value="#{userController.selected.address1}" />

                                <h:outputText value="Address Line 2:"/>
                                <h:outputText value="#{userController.selected.address2}" />

                                <h:outputText value="City:"/>
                                <h:outputText value="#{userController.selected.city}" />

                                <h:outputText value="State:"/>
                                <h:outputText value="#{userController.selected.state}" />

                                <h:outputText value="Zip Code"/>
                                <h:outputText value="#{userController.selected.zipcode}" />

                                <h:outputText value="Email:"/>
                                <h:outputText value="#{userController.selected.email}" />

                                <h:outputText value="Username:"/>
                                <h:outputText value="#{userController.selected.username}" />

                            </p:panelGrid>
                        </td>
                    </tr>
                </table>
                </div>
            </h:form>

            <!-- 
            =================================================================
            Dialog for Security Question and Answer for User Account Deletion
            =================================================================
            -->
            <p:dialog id="SecurityQuestionDlg" header="Security Question" widgetVar="SecurityQuestionDialog"
                      modal="true" width="80%" position="center" appendTo="@(body)"
                      showEffect="blind" hideEffect="fade" responsive="true" >

                <h:form id="SecurityQuestionForm">
                    <fieldset>
                        <div style="margin-bottom:20px">
                            <h:outputLabel for="answer" value="#{userController.getSelectedSecurityQuestion()}"/>
                        </div>

                        <div style="margin-bottom:10px">
                            <p:inputText id="answer" value="#{userController.answerToSecurityQuestion}"
                                         style="width: 290px" required="true"
                                         requiredMessage="Please enter your answer to the security question!" />
                        </div>
                        <br/>
                        <div align="center">
                            <!--
                            ================================
                            |         SUBMIT Button        |
                            ================================
                            -->
                            <p:commandButton id="Submit" value="Submit" icon="fas fa-arrow-up" styleClass="rounded-button"
                                             ajax="false" action="#{userController.securityAnswerSubmit()}"
                                             update=":growlInfoMessage, :growlErrorMessage, :growlFatalMessage, :growlWarningMessage"
                                             oncomplete="PF('SecurityQuestionDialog').hide()"/>
                            &nbsp;
                            <!--
                            ================================
                            |        CANCEL Button         |
                            ================================

                            JSF application lifecycle execute phase contains the following subphases: 
                            [See https://docs.oracle.com/javaee/6/tutorial/doc/bnaqq.html for detailed description]

                                1. Restore View Phase
                                2. Apply Request Values Phase
                                3. Process Validations Phase
                                4. Update Model Values Phase
                                5. Invoke Application Phase
                                6. Render Response Phase

                            immediate="true" causes the execution of only the Apply Request Values Phase. 
                            Therefore, the <f:event> validation is not performed since the operation is cancelled.
                            -->
                            <p:commandButton id="cancel" value="Cancel" icon="fas fa-ban" styleClass="ui-button-outlined"
                                             immediate="true" oncomplete="PF('SecurityQuestionDialog').hide()" />
                        </div>
                        <br />
                    </fieldset>
                </h:form>
            </p:dialog>
        </ui:define>
    </ui:composition>
</html>
